/*!
* Mediator.js Library v0.11.0
* https://github.com/ajacksified/Mediator.js
*
* Copyright 2018, Jack Lawson
* MIT Licensed (http://www.opensource.org/licenses/mit-license.php)
*
* For more information: http://thejacklawson.com/2011/06/mediators-for-modularized-asynchronous-programming-in-javascript/index.html
* Project on GitHub: https://github.com/ajacksified/Mediator.js
*
* Last update: 22 Mar 2018
*/ !function(t,s){"use strict";"function"==typeof define&&define.amd?define([],function(){return t.Mediator=s(),t.Mediator}):"undefined"!=typeof exports?exports.Mediator=s():t.Mediator=s()}(this,function(){"use strict";function t(s,i,n){var r;if(!(this instanceof t))return new t(s,i,n);this.id=(r=function(){return((1+Math.random())*65536|0).toString(16).substring(1)})()+r()+"-"+r()+"-"+r()+"-"+r()+"-"+r()+r()+r(),this.fn=s,this.options=i,this.context=n,this.channel=null}function s(t,i){if(!(this instanceof s))return new s(t);this.namespace=t||"",this._subscribers=[],this._channels={},this._parent=i,this.stopped=!1}function i(){if(!(this instanceof i))return new i;this._channels=new s("")}return t.prototype.update=function(t){t&&(this.fn=t.fn||this.fn,this.context=t.context||this.context,this.options=t.options||this.options,this.channel&&this.options&&void 0!==this.options.priority&&this.channel.setPriority(this.id,this.options.priority))},s.prototype.channelPrioritySort=function(t,s){return t.options.priority>s.options.priority?-1:t.options.priority<s.options.priority?1:0},s.prototype.addSubscriber=function(s,i,n){i||(i={priority:0}),i.priority=0|i.priority;var r=new t(s,i,n);return r.channel=this,this._subscribers.push(r),this._subscribers.sort(this.channelPrioritySort),r},s.prototype.stopPropagation=function(){this.stopped=!0},s.prototype.getSubscriber=function(t){for(var s=0,i=this._subscribers.length;s<i;s++)if(this._subscribers[s].id===t||this._subscribers[s].fn===t)return this._subscribers[s]},s.prototype.setPriority=function(t,s){for(var i=0,n=this._subscribers.length;i<n;i++)if(this._subscribers[i].id===t||this._subscribers[i].fn===t){this._subscribers[i].options.priority=s;break}this._subscribers.sort(this.channelPrioritySort)},s.prototype.addChannel=function(t){this._channels[t]=new s((this.namespace?this.namespace+":":"")+t,this)},s.prototype.hasChannel=function(t){return this._channels.hasOwnProperty(t)},s.prototype.returnChannel=function(t){return this._channels[t]},s.prototype.removeSubscriber=function(t,s){var i=this._subscribers.length-1;if(s=void 0===s||s,t)for(;i>=0;i--)(this._subscribers[i].fn===t||this._subscribers[i].id===t)&&(this._subscribers[i].channel=null,this._subscribers.splice(i,1));else this._subscribers=[];s&&this.autoCleanChannel();var i=this._subscribers.length-1;if(!t){this._subscribers=[];return}for(;i>=0;i--)(this._subscribers[i].fn===t||this._subscribers[i].id===t)&&(this._subscribers[i].channel=null,this._subscribers.splice(i,1))},s.prototype.autoCleanChannel=function(){if(0===this._subscribers.length){for(var t in this._channels)if(this._channels.hasOwnProperty(t))return;if(null!=this._parent){var s=this.namespace.split(":"),i=s[s.length-1];this._parent.removeChannel(i)}}},s.prototype.removeChannel=function(t){this.hasChannel(t)&&(this._channels[t]=null,delete this._channels[t],this.autoCleanChannel())},s.prototype.publish=function(t){for(var s,i,n,r=0,e=this._subscribers.length,o=!1;r<e;r++)o=!1,s=this._subscribers[r],!this.stopped&&(i=this._subscribers.length,void 0!==s.options&&"function"==typeof s.options.predicate?s.options.predicate.apply(s.context,t)&&(o=!0):o=!0),o&&(s.options&&void 0!==s.options.calls&&(s.options.calls--,s.options.calls<1&&this.removeSubscriber(s.id)),s.fn.apply(s.context,t),e=n=this._subscribers.length,n===i-1&&r--);this._parent&&this._parent.publish(t),this.stopped=!1},i.prototype.getChannel=function(t,s){var i=this._channels,n=t.split(":"),r=0,e=n.length;if(""===t)return i;if(n.length>0)for(;r<e;r++){if(!i.hasChannel(n[r])){if(s)break;i.addChannel(n[r])}i=i.returnChannel(n[r])}return i},i.prototype.subscribe=function(t,s,i,n){var r;return i=i||{},n=n||{},this.getChannel(t||"",!1).addSubscriber(s,i,n)},i.prototype.once=function(t,s,i,n){return(i=i||{}).calls=1,this.subscribe(t,s,i,n)},i.prototype.getSubscriber=function(t,s){var i=this.getChannel(s||"",!0);return i.namespace!==s?null:i.getSubscriber(t)},i.prototype.remove=function(t,s,i){var n=this.getChannel(t||"",!0);if(n.namespace!==t)return!1;n.removeSubscriber(s,i)},i.prototype.publish=function(t){var s=this.getChannel(t||"",!1);if(s.namespace!==t)return null;var i=Array.prototype.slice.call(arguments,1);i.push(s),s.publish(i)},i.prototype.on=i.prototype.subscribe,i.prototype.bind=i.prototype.subscribe,i.prototype.emit=i.prototype.publish,i.prototype.trigger=i.prototype.publish,i.prototype.off=i.prototype.remove,i.Channel=s,i.Subscriber=t,i.version="0.10.1",i});
